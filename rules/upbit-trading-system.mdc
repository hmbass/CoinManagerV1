---
alwaysApply: true
description: Upbit day-trade automator development rules based on requirement.md
---

# ì—…ë¹„íŠ¸ ë‹¨íƒ€ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ ê°œë°œ ê·œì¹™

## ğŸ“‹ SSOT (Single Source of Truth)

**ì ˆëŒ€ ê·œì¹™**: [requirement.md](mdc:Requirement/requirement.md)ë¥¼ ëª¨ë“  ê°œë°œì˜ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìŠµë‹ˆë‹¤.
- ëª¨ë“  ê¸°ëŠ¥ êµ¬í˜„ì€ requirement.md ëª…ì„¸ë¥¼ ì •í™•íˆ ë”°ë¦…ë‹ˆë‹¤
- íŒŒë¼ë¯¸í„°, ì•Œê³ ë¦¬ì¦˜, ë°ì´í„° ëª¨ë¸ì€ requirement.mdì™€ ì¼ì¹˜ì‹œí‚µë‹ˆë‹¤
- ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° requirement.mdë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡° (Requirement.md 13ì¥ ì¤€ìˆ˜)

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/           # REST/WS í´ë¼ì´ì–¸íŠ¸ (upbit_rest.py, upbit_ws.py)
â”‚   â”œâ”€â”€ data/          # í”¼ì²˜ ê³„ì‚°, ë³€í™˜ (features.py, candles.py)
â”‚   â”œâ”€â”€ scanner/       # ìŠ¤ì½”ì–´ë§, í›„ë³´ ì„ ì • (scanner.py)
â”‚   â”œâ”€â”€ signals/       # ORB/sVWAP/Sweep (orb.py, svwap_pullback.py, sweep.py)
â”‚   â”œâ”€â”€ risk/          # í¬ì§€ì…˜ í¬ê¸°, DDL (guard.py)
â”‚   â”œâ”€â”€ order/         # ì£¼ë¬¸/ì²´ê²°, OCO-like (executor.py)
â”‚   â”œâ”€â”€ backtest/      # ì„ íƒ: ì‹œë®¬ë ˆì´ì…˜
â”‚   â”œâ”€â”€ utils/         # ê³µí†µ(ì‹œê°„ëŒ€, ë¡œê·¸) (config.py, time_utils.py, logging.py)
â”‚   â””â”€â”€ app.py         # ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ runtime/
â”‚   â”œâ”€â”€ logs/
â”‚   â””â”€â”€ reports/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
```

## ğŸ Python ê°œë°œ í‘œì¤€

### 1. ì˜ì¡´ì„± ê´€ë¦¬
- **pyproject.toml** ì‚¬ìš© (PEP 518/621 ì¤€ìˆ˜)
- **Python 3.11+** í•„ìˆ˜
- í•µì‹¬ íŒ¨í‚¤ì§€: `requests`, `websockets`, `pandas`, `numpy`, `pyjwt`, `pydantic`, `uvloop`

### 2. ì„¤ì • ê´€ë¦¬
- **config.yaml**: ëª¨ë“  íŒŒë¼ë¯¸í„° ì™¸ë¶€í™” (requirement.md 7ì¥ êµ¬ì¡° ì¤€ìˆ˜)
- **.env.example**: API í‚¤ ë“± ë¯¼ê° ì •ë³´ í…œí”Œë¦¿
- **Pydantic**: ì„¤ì • ê²€ì¦ ë° íƒ€ì… ì•ˆì „ì„± ë³´ì¥

### 3. ì½”ë“œ í’ˆì§ˆ
- **íƒ€ì… íŒíŠ¸** í•„ìˆ˜ ì‚¬ìš©
- **docstring** PEP 257 ì¤€ìˆ˜
- **Makefile**: lint/test/run/docker-* ëª…ë ¹ ì œê³µ
- **Black + isort + flake8**: ì½”ë“œ í¬ë§¤íŒ… ë° ë¦°íŒ…

## ğŸ“Š í•µì‹¬ ëª¨ë“ˆ êµ¬í˜„ ê°€ì´ë“œ

### 1. API ëª¨ë“ˆ (src/api/)
```python
# upbit_rest.py - REST API í´ë¼ì´ì–¸íŠ¸
- /v1/market/all?isDetails=true
- /v1/candles/minutes/{unit}
- /v1/orderbook?markets=
- /v1/orders (JWT ì¸ì¦)

# upbit_ws.py - WebSocket í´ë¼ì´ì–¸íŠ¸  
- ticker/trade ì±„ë„ êµ¬ë…
- ìë™ ì¬ì—°ê²° ë¡œì§
- ë°±ì˜¤í”„ ì „ëµ
```

### 2. ë°ì´í„° ëª¨ë“ˆ (src/data/)
```python
# features.py - í”¼ì²˜ ê³„ì‚° (requirement.md 6ì¥ ì•Œê³ ë¦¬ì¦˜)
- RVOL: rv = vol[-1] / mean(vol[-21:-1])
- RS(60m): rs = ret60(sym) âˆ’ ret60(KRW-BTC) 
- sVWAP: cumsum(price*volume)/cumsum(volume)
- ATR(14), EMA20/50
- Trend: (EMA20>EMA50) and (close > sVWAP)
```

### 3. ìŠ¤ìºë„ˆ ëª¨ë“ˆ (src/scanner/)
```python
# scanner.py - í›„ë³´ ì„ ë³„ (requirement.md FR-4)
- ìŠ¤ì½”ì–´: 0.4Ã—RS + 0.3Ã—RVOL_Z + 0.2Ã—Trend + 0.1Ã—Depth
- í•„í„°: RVOLâ‰¥2, ìŠ¤í”„ë ˆë“œâ‰¤5bp, Trend=1
- ìƒìœ„ 2~3ê°œ ë°˜í™˜
```

### 4. ì‹ í˜¸ ëª¨ë“ˆ (src/signals/)
```python
# orb.py - ORB ëŒíŒŒ (requirement.md FR-5A)
# svwap_pullback.py - sVWAP ë˜ëŒë¦¼ (requirement.md FR-5B)  
# sweep.py - ìœ ë™ì„± ìŠ¤ìœ• (requirement.md FR-5C)
```

### 5. ì£¼ë¬¸ ëª¨ë“ˆ (src/order/)
```python
# executor.py - ì£¼ë¬¸ ì‹¤í–‰ (requirement.md FR-6)
- JWT ì¸ì¦ êµ¬í˜„
- IOC/FOK/BEST ì£¼ë¬¸ íƒ€ì…
- ì‹¤ê±°ë˜/í˜ì´í¼ íŠ¸ë ˆì´ë”© ë¶„ê¸°
- OCO-like êµ¬í˜„
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### 1. Unit Tests (tests/unit/)
- ê° ëª¨ë“ˆë³„ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- í”¼ì²˜ ê³„ì‚° ì •í™•ì„± ê²€ì¦
- Mock ê°ì²´ í™œìš©í•œ API í…ŒìŠ¤íŠ¸

### 2. Integration Tests (tests/integration/)
- API ì—°ë™ í…ŒìŠ¤íŠ¸ (ëª¨ì˜ ì„œë²„)
- ì „ì²´ ì›Œí¬í”Œë¡œ í…ŒìŠ¤íŠ¸
- í˜ì´í¼ íŠ¸ë ˆì´ë”© ê²€ì¦

## ğŸ“ ë¡œê¹… ë° ë¦¬í¬íŒ…

### 1. ë¡œê¹… (requirement.md FR-8)
```python
# JSON êµ¬ì¡°í™” ë¡œê·¸
{
  "timestamp": "2024-01-01T09:10:00+09:00",
  "level": "INFO", 
  "module": "scanner",
  "message": "Found 3 candidates",
  "data": {"candidates": [...]}
}
```

### 2. ë¦¬í¬íŒ… (runtime/reports/)
- ì¼ì¼ ìš”ì•½ JSON íŒŒì¼
- PnL, ìŠ¹ë¥ , ê¸°ëŒ€ê°’ ê³„ì‚°
- ê±°ë˜ ìƒì„¸ ë¡œê·¸

## ğŸš€ ì‹¤í–‰ ì¸í„°í˜ì´ìŠ¤

### CLI ëª…ë ¹ì–´
```bash
# ìŠ¤ìº” ì‹¤í–‰
python -m src.app scan

# í˜ì´í¼ íŠ¸ë ˆì´ë”© ì‹¤í–‰  
python -m src.app run --paper

# ì‹¤ê±°ë˜ ì‹¤í–‰
python -m src.app run --live

# ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python -m src.app backtest --start=2024-01-01 --end=2024-01-31
```

## âš™ï¸ ì„¤ì • íŒŒë¼ë¯¸í„° (config.yaml)

requirement.md 7ì¥ êµ¬ì¡°ë¥¼ ì •í™•íˆ ë”°ë¦…ë‹ˆë‹¤:
```yaml
exchange:
  base_url: https://api.upbit.com
  websocket_url: wss://api.upbit.com/websocket/v1

scanner:
  rvol_threshold: 2.0
  spread_bp_max: 5
  candle_count: 200

signals:
  orb:
    use: true
    breakout_atr_mult: 0.1
  svwap_pullback:
    use: true
    zone_atr_mult: 0.25

risk:
  per_trade_risk_pct: 0.004
  daily_drawdown_stop_pct: 0.01
```

## ğŸ›¡ï¸ ë³´ì•ˆ ë° ì•ˆì „ì¥ì¹˜

### 1. API í‚¤ ê´€ë¦¬
- .env íŒŒì¼ ì‚¬ìš© (.gitignore í¬í•¨)
- í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…
- ë¡œê·¸ì— ë…¸ì¶œ ë°©ì§€

### 2. ë¦¬ìŠ¤í¬ ê´€ë¦¬ (requirement.md FR-7)
- í¬ì§€ì…˜ í¬ê¸° ìë™ ê³„ì‚°
- DDL(-1%) ë„ë‹¬ ì‹œ ì¤‘ë‹¨
- ì—°ì† ì†ì ˆ ë°©ì§€

## ğŸ“¦ ë°°í¬ ë° ì‹¤í–‰

### Makefile ëª…ë ¹ì–´
```make
install:     # ì˜ì¡´ì„± ì„¤ì¹˜
lint:        # ì½”ë“œ ê²€ì‚¬
test:        # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
run-paper:   # í˜ì´í¼ íŠ¸ë ˆì´ë”©
run-live:    # ì‹¤ê±°ë˜ (ì£¼ì˜)
docker-build: # Docker ì´ë¯¸ì§€ ë¹Œë“œ
```

## ğŸ”„ ê°œë°œ ì›Œí¬í”Œë¡œ

1. **ê¸°ëŠ¥ êµ¬í˜„**: requirement.md ëª…ì„¸ ê¸°ë°˜
2. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ê° ëª¨ë“ˆ ê²€ì¦
3. **í†µí•© í…ŒìŠ¤íŠ¸**: ì „ì²´ í”Œë¡œìš° ê²€ì¦  
4. **í˜ì´í¼ í…ŒìŠ¤íŠ¸**: ì‹¤ì œ APIë¡œ ëª¨ì˜ê±°ë˜
5. **ì‹¤ê±°ë˜ ë°°í¬**: ì¶©ë¶„í•œ ê²€ì¦ í›„

## âš ï¸ ì¤‘ìš” ì£¼ì˜ì‚¬í•­

1. **ì‹¤ê±°ë˜ ê¸ˆì§€**: ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ ì „ê¹Œì§€ --paper ëª¨ë“œë§Œ ì‚¬ìš©
2. **API ë ˆì´íŠ¸ ë¦¬ë°‹**: ì—…ë¹„íŠ¸ ì œí•œ ì¤€ìˆ˜
3. **ì—ëŸ¬ í•¸ë“¤ë§**: ëª¨ë“  ì™¸ë¶€ API í˜¸ì¶œì— ì˜ˆì™¸ ì²˜ë¦¬
4. **ë¡œê·¸ ë¯¼ê°ì •ë³´**: API í‚¤, ê°œì¸ì •ë³´ ë¡œê·¸ ì¶œë ¥ ê¸ˆì§€
5. **íƒ€ì„ì¡´**: Asia/Seoul ê³ ì • ì‚¬ìš©

ì´ ê·œì¹™ë“¤ì„ ì¤€ìˆ˜í•˜ì—¬ ì•ˆì „í•˜ê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì—…ë¹„íŠ¸ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì„ ê°œë°œí•˜ì„¸ìš”.